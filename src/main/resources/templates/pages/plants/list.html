<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layouts/base}">
<head><title>My Garden</title></head>
<body>
<div layout:fragment="content">
    
    <!-- HEADER -->
    <div class="row mb-4 align-items-center fade-in">
        <div class="col-md-8">
            <h2 class="fw-bold text-success"><i class="fas fa-leaf me-2"></i>Kebunku</h2>
            <p class="text-muted">Kelola koleksi tanamanmu di sini.</p>
        </div>
        <div class="col-md-4 text-end">
            <a th:href="@{/plants/new}" class="btn btn-success rounded-pill px-4 shadow-sm hover-up">
                <i class="fas fa-plus me-2"></i>Tambah Tanaman
            </a>
        </div>
    </div>

    <!-- STATISTIK (SAMA SEPERTI SEBELUMNYA) -->
    <div class="row g-4 mb-5 fade-in">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm rounded-4 h-100 bg-success bg-opacity-10">
                <div class="card-body d-flex align-items-center p-4">
                    <div class="icon-box bg-white text-success shadow-sm rounded-circle me-3" style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-seedling fa-2x"></i>
                    </div>
                    <div>
                        <h2 class="fw-bold mb-0 text-success" th:text="${totalPlants}">0</h2>
                        <small class="text-muted fw-bold">Total Koleksi</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm rounded-4 h-100" 
                 th:classappend="${needsWater > 0} ? 'bg-danger bg-opacity-10' : 'bg-info bg-opacity-10'">
                <div class="card-body d-flex align-items-center p-4">
                    <div class="icon-box bg-white shadow-sm rounded-circle me-3" 
                         th:classappend="${needsWater > 0} ? 'text-danger' : 'text-info'"
                         style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-tint fa-2x"></i>
                    </div>
                    <div>
                        <h2 class="fw-bold mb-0" 
                            th:classappend="${needsWater > 0} ? 'text-danger' : 'text-info'" 
                            th:text="${needsWater}">0</h2>
                        <small class="text-muted fw-bold">Perlu Disiram</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm rounded-4 h-100">
                <div class="card-body p-3 d-flex align-items-center justify-content-between">
                    <div>
                        <h5 class="fw-bold text-dark mb-1">Status Air</h5>
                        <p class="text-muted small mb-0"><span th:text="${healthy}">0</span> Terawat</p>
                        <p class="text-danger small fw-bold mb-0"><span th:text="${needsWater}">0</span> Haus</p>
                    </div>
                    <div style="width: 100px; height: 100px;">
                        <canvas id="miniChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DAFTAR DATA -->
    <div class="row g-4">
        <div class="col-md-6 col-lg-4 fade-in" th:each="plant : ${plants}">
            <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden hover-card">
                <!-- Gambar -->
                <div style="height: 220px; overflow: hidden; position: relative;">
                    <img th:src="${plant.imagePath != null} ? @{/uploads/{path}(path=${plant.imagePath})} : 'https://placehold.co/400x300?text=No+Image'" 
                         class="w-100 h-100 object-fit-cover transition-zoom">
                    
                    <div class="position-absolute top-0 end-0 p-2">
                        <span class="badge bg-white text-success shadow-sm rounded-pill px-3 py-2" th:text="${plant.species}">Spesies</span>
                    </div>
                </div>
                
                <div class="card-body">
                    <h5 class="fw-bold mb-1 text-dark" th:text="${plant.name}">Nama Tanaman</h5>
                    <div class="d-flex justify-content-between mb-3">
                        <small class="text-muted">Jadwal: <span th:text="${plant.wateringFrequency}"></span> hari sekali</small>
                        
                        <!-- Info Terakhir Disiram -->
                        <small th:classappend="${plant.lastWatered != null && plant.lastWatered.isEqual(T(java.time.LocalDate).now())} ? 'text-success fw-bold' : 'text-muted'">
                            <i class="fas fa-history me-1"></i> <span th:text="${plant.lastWatered}"></span>
                        </small>
                    </div>
                    
                    <hr class="border-light">

                    <div class="d-flex justify-content-between align-items-center">
                        
                        <!-- TOMBOL CEPAT: SIRAM -->
                        <a th:href="@{/plants/{id}/water(id=${plant.id})}" 
                           class="btn btn-outline-info btn-sm rounded-pill px-3 fw-bold"
                           title="Klik untuk siram hari ini">
                            <i class="fas fa-tint me-1"></i> Siram
                        </a>
                        
                        <div class="btn-group">
                            <a th:href="@{/plants/{id}(id=${plant.id})}" class="btn btn-sm btn-light text-secondary"><i class="fas fa-eye"></i></a>
                            <a th:href="@{/plants/{id}/edit(id=${plant.id})}" class="btn btn-sm btn-light text-warning"><i class="fas fa-edit"></i></a>
                            <a th:href="@{/plants/{id}/delete(id=${plant.id})}" class="btn btn-sm btn-light text-danger rounded-end-pill" onclick="return confirm('Yakin hapus?')"><i class="fas fa-trash"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Jika Kosong -->
        <div class="col-12 text-center py-5" th:if="${#lists.isEmpty(plants)}">
            <div class="bg-light rounded-circle p-4 d-inline-block mb-3">
                <i class="fas fa-seedling fa-3x text-muted"></i>
            </div>
            <h5 class="fw-bold text-muted">Kebunmu masih kosong</h5>
            <p class="text-muted small">Mulai tambahkan tanaman pertamamu sekarang!</p>
        </div>
    </div>
</div>

<th:block layout:fragment="others-js">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
        const needsWater = /*[[${needsWater}]]*/ 0;
        const healthy = /*[[${healthy}]]*/ 0;
        
        const ctx = document.getElementById('miniChart');
        if(ctx) {
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Haus', 'Terawat'],
                    datasets: [{
                        data: [needsWater, healthy],
                        backgroundColor: ['#dc3545', '#198754'],
                        borderWidth: 0,
                        cutout: '70%'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } }
                }
            });
        }
    </script>
</th:block>

<th:block layout:fragment="others-css">
    <style>
        .hover-up:hover { transform: translateY(-3px); }
        .hover-card { transition: all 0.3s ease; }
        .hover-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.08) !important; }
        .transition-zoom { transition: transform 0.5s ease; }
        .hover-card:hover .transition-zoom { transform: scale(1.1); }
    </style>
</th:block>
</body>
</html>